<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="alternate" type="application/rss+xml" title="【数字科技】 – 人工智能，大数据，云计算，区块链，教育培训领域" href="https://jysperm.me/atom.xml"><link rel="stylesheet" href="/styles.css"><title>Android 程序框架设计 | 【数字科技】 – 人工智能，大数据，云计算，区块链，教育培训领域</title></head><body><div class="container"><div class="columns page-header"><h1>【数字科技】 – 人工智能，大数据，云计算，区块链，教育培训领域</h1></div><div class="columns"><div class="navigation"><nav class="menus-main"><a href="/" class="favicon"><img alt="【数字科技】 – 人工智能，大数据，云计算，区块链，教育培训领域" src="/favicon.png"></a><a href="/">首页</a></nav></div></div><div class="columns"><div class="block-body column three-fourths"><article><header><small class="right"><a target="_blank" href="null_posts%2F1021417678.md">查看源代码</a></small><h1>Android 程序框架设计</h1></header><div class="article-meta clearfix"><time class="left">2013-05-31</time><ul class="tags left"></ul><ul class="tags right"></ul></div><div class="markdown-body"><p>这篇文章主要内容来自于之前我讲的一个PPT文档，现在将其整理如下。欢迎指正。以下的内容都是来自于我自身的经验，欢迎大家多提自己的建议。</p>
<h2 id="1、一些概念"><a href="#1、一些概念" class="headerlink" title="1、一些概念"></a>1、一些概念</h2><p>&nbsp;</p>
<p><strong>模式的定义：</strong></p>
<p>每个模式都描述了一个在我们的环境中不断出现的问题，然后描述了该问题的解决方案的核心。通过这种方式，你可以无数次地使用那些已有的解决方案，无需在重复相同的工作。</p>
<p><strong>什么是设计模式？</strong></p>
<p>设计模式是在某种特别的情况下，针对某种问题的某种典型、通用的解决方法。</p>
<p>我们是需要适当了解并学习一些设计模式，在程序开发过程中，总是会涉及到一些框架设计，模块设计之类的东西，如果能很好理解并运行设计模式，你所设计的模块或框架将会要稳定得多，因为这些设计模式它们都是通用的解决方案，是经过实践经验了的</p>
<p>比如说，在程序里，可能会有通知模块，A模块的数据发生变化，B模块需要得到通知，对于这样的需要，你可能会想到用&#8221;广播&#8221;，&#8221;消息&#8221;或者&#8221;回调&#8221;的方式来解决，的确，刚才我所说的那三种也能解决，但是，这三种都是存在一些缺点，比如说广播，用Intent来传输数据很困难，对于&#8221;消息&#8221;，无法很好的跟踪，对于&#8221;回调&#8221;，有可能你A与B模块根本不可相互访问。此时，如果你会用<strong>观察者</strong>模式的问题，这种问题可以很轻松解决。</p>
<p>当然，这里是需要具体问题具体分析的，我主要的意思就是说，要适当利用模式，我们不能为了用模式而去用模式，我们是要用模式来解决我们实际的问题。</p>
<p><strong>概念完整性</strong></p>
<p>关于概念完整性，在《人月神话》一书在有大量的阐述，这里，我把我的理解写出来，与大家分享。</p>
<p>1）概念完整性是系统设计中最重要的考虑因素。当你的系统规模越大，这一点体现得越明显。</p>
<p>2）为了获取概念的完整性，设计必须由一个人或者具有共识的小型团队来完成。这一点很好理解，关于设计，可以让所有的人参与，但是决定权在少数人手里，如果大家都想参与设计，这是根本没有办法保证系统设计是统一完整的。</p>
<p>3）要获得概念上的完整性，就必须有人控制这些概念，类似于贵族的专制统治。这里，对于团队中的项目经理或架构师必须对项目有绝对的权威，不然，这个项目里面的就无法统一号令。</p>
<p>4）概念完整性表现有：</p>
<ul>
<li><p>开发过程中，需求、设计、编码的一致性</p>
</li>
<li><p>整个程序具有统一的风格，比如对话框样式，按钮风格，色调等UI元素</p>
</li>
<li><p>整个程序具体统一的结构，比如不同模块访问网络，它们的调用方式一致，例如异步访问都用回调方式通知结果，相同的功能应该提取成共通模块。</p>
</li>
<li><p>开发人员能很好的执行需求人员和设计人员的意图。</p>
</li>
<li><p>有完整的文档，需求文档，设计文档，测试文档，处理流程的文档等。</p>
</li>
</ul>
<p><strong>如何保持概念完整性</strong></p>
<ul>
<li><p>在制度上给予保证，产品的负责人必须建立技术上的绝对权威</p>
</li>
<li><p>术负责人员（SE，SL）必须严格执行项目的需求，设计，必须深入到编码细节</p>
</li>
<li><p>在不同阶段，保持与所有人员的持续沟通，鼓励开发人员提意见。</p>
</li>
<li><p>让开发人员参与设计，但不决定设计</p>
</li>
<li><p>通过持续的反馈和沟通来实现模块重用</p>
</li>
</ul>
<h2 id="2、设计之前应该做什么"><a href="#2、设计之前应该做什么" class="headerlink" title="2、设计之前应该做什么"></a>2、设计之前应该做什么</h2><p><strong>2.1 共通类的设计</strong></p>
<p><strong>2.1.1 Widget设计</strong></p>
<ul>
<li>TextView</li>
<li>EditText</li>
<li>Button</li>
<li>Title bar</li>
<li>Tool bar</li>
<li>&#8230;</li>
</ul>
<p><strong>为什么要提供这些共通控件？</strong></p>
<ul>
<li>统一字体大小，如App字体不随系统字体变化而变化</li>
<li>统一UI式样，如Button， EditText具有相同的背景等</li>
<li>复用代码</li>
</ul>
<p><strong>2.1.2 Adapter Items</strong></p>
<ul>
<li>根据式样，提取需要在AdapterView中显示的Item</li>
<li>简单的复合布局</li>
<li><p>自绘制，从而提高滑动性能</p>
<ul>
<li><p>ListView中放Gallery时，提高上下滑动性能</p>
</li>
<li><p>尽量优化绘制</p>
</li>
</ul>
</li>
</ul>
<p><strong>数据驱动</strong></p>
<ul>
<li><p>Adapter Items提供核心的方法</p>
<ul>
<li><p>setData(Object data)</p>
</li>
<li><p>getData();</p>
</li>
</ul>
</li>
<li><p>Adapter#getView实现更加简单</p>
<ul>
<li><p>实现简单</p>
</li>
<li><p>不会因为UI变化而变化</p>
</li>
</ul>
</li>
</ul>
<p>下面代码示例了Adapter#getView()方法的实现，它返回BookView，BookView提供方法来接收数据，至于BookView的显示，则根据设置的数据来显示，这就是数据驱动UI。</p>
<p>&nbsp;</p>
<pre><code>[java] view plaincopy




  @Override


  public View getView(int position, View convertView, ViewGroup parent) {




      if (null == convertView) {


          convertView = new BookView(getContext());


          convertView.setLayoutParameter(new AbsListView.LayoutParameter(150, 150));


      }




      Book book = m_bookList.get(position);


      BookView bookView = (BookView)convertView;


      bookView.setBook(book);




      return convertView;


  }
</code></pre><p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>2.1.3 Dialog</strong></p>
<ul>
<li>扩展于Dialog类</li>
<li>提供Dialog关闭的事件</li>
<li>Dialog的高度随内容的变化而变化</li>
<li>可以设置按钮的文字，可见性，字体等方法</li>
<li>设置按钮点击事件的listener</li>
<li>要考虑对话框的三个属性：Title, Content area, Action buttons</li>
</ul>
<p><strong>2.1.4 Utility</strong></p>
<ul>
<li>Log</li>
<li>DateFormat</li>
<li>Bitmap</li>
<li>Notification</li>
<li>Shared Preference</li>
<li>Environment</li>
<li>Device</li>
<li>&#8230;</li>
</ul>
<p><strong>2.2 Task管理</strong></p>
<p>线程只是一种机制，保证我们要完成的任务不运行在UI线程（也就是说不阻塞UI），完成的任务才是我们关注的核心，因此，我们可以通过设计，把线程封装，让使用者根本感觉不到是线程，他只用关心他要做的事情就行了。</p>
<p>这里，我们可以设计一种&#8221;异步链式调用&#8221;的框架，把线程进行了封装。使用都只需要这样用：</p>
<p>&nbsp;</p>
<pre><code>[java] view plaincopy




  new TaskManager()


  .next(task1)


  .next(task2)


  .next(task3).


  .execute();
</code></pre><p>&nbsp;</p>
<p>&nbsp;</p>
<p>这里，task1, task2, task3是顺序执行的，举个例子：我们要访问网络，取得一个图片，使用这个TaskManager我们需要3个task，</p>
<p>task1:显示一个ProgressDialog。</p>
<p>task2:访问网络，创建bitmap。</p>
<p>task3:关闭对话框，显示bitmap。</p>
<p>这一点，可以参考CoreLib工程中的task.TaskManager类。</p>
<p>关于TaskManager，有以下几点需要注意：</p>
<ul>
<li>封装了线程</li>
<li>让调用者只关注自己的业务处理</li>
<li>保证顺序链式地执行某一个任务</li>
<li>上一个任务的输出，作为下一个任务的输入</li>
<li>能暂停、恢复任何一个任务</li>
</ul>
<p><strong>2.3 缓存设计</strong></p>
<ul>
<li>把内存占用量大的对象存放在缓存中，如bitmap</li>
<li>利用了LruCache类来实现</li>
<li>利用了AsyncTask类来加载bitmap</li>
<li>不用再手动释放bitmap内存，该操作有风险</li>
<li>不用再关心AbsListView的scroll状态</li>
</ul>
<p>关于缓存的更多详细细节，请参考[ 请参考CoreLib工程中的cache包 ]。</p>
<p>这样做，有什么好处， 不用再手动释放bitmap内在，该操作有风险，因为该bitmap是否有View引用，如果当一个View在试图绘制一个已经回收的bitmap，这里会抛出异常。</p>
<p><strong>2.4 线程管理</strong></p>
<p><strong>无消息循环的线程：</strong></p>
<p>&nbsp;</p>
<pre><code>[java] view plaincopy




  new Thread(null, new Runnable() {


      public void run() {


          // Do you works.


      }




  }, &amp;#8221;Thread_name_xxx&amp;#8221;).start();
</code></pre><p>&nbsp;</p>
<p>&nbsp;</p>
<p>什么情况下使用这种线程：</p>
<ul>
<li>做完一件事情就结束，这件事发生频率不高，比如从SD card中读取图片数据</li>
<li>不需要复用线程</li>
</ul>
<p>在使用线程，最好给线程加上名字，这样利用高度与跟踪。</p>
<p><strong>有消息循环的线程：</strong></p>
<p>这样的线程拥有消息循环，当消息队列中没有消息时，这个线程会被挂起。我们要做一件事情时，只需要给它发送一个消息就行了。</p>
<p>这种情况通常是为了复用线程，不用频繁创建线程，比如音乐播放器程序，专门启动一个有消息循环的线程来获得音乐的专辑图片。</p>
<p>我们通常还要创建一个与这个线程的消息循环（Looper）相关联的Handler，由它来处理消息，注意，这做的事情是运行在后台线程的。</p>
<h2 id="3，程序框架如何设计"><a href="#3，程序框架如何设计" class="headerlink" title="3，程序框架如何设计"></a>3，程序框架如何设计</h2><p><strong>Android程序的结构</strong></p>
<ul>
<li>UI层 <ul>
<li>数据展示与管理</li>
<li>用户交互</li>
<li>绘制</li>
<li>Adapter</li>
</ul>
</li>
<li>业务逻辑层 <ul>
<li>持久化数据（内存中，相当于全局数据）</li>
<li>数据加式（数据层的数据有时候需要进行加工成UI层需要的数据）</li>
<li>数据变化的通知机制</li>
</ul>
</li>
<li>数据层 <ul>
<li>数据访问（DB，文件，网络等）</li>
<li>缓存（图片，文件等）</li>
<li>配置文件（shared perference）</li>
</ul>
</li>
</ul>
<p>下面，我试着画了一个Android程序的结构，如果有不好的地方，欢迎指正。</p>
<pre><code>![][1]
</code></pre><h2 id="4，一些基本原则"><a href="#4，一些基本原则" class="headerlink" title="4，一些基本原则"></a>4，一些基本原则</h2><p>下面列出一些通常的原则，我们应当在开发过程中遵循，欢迎补充与指正。</p>
<p><strong>4.1 提供initialize()方法</strong></p>
<p>在Activity.onCreate()或者View的构造方法中调用，在以后看代码时，人们通常首先会去找initialize()这样的方法。</p>
<p><strong>4.2 封装点击事件</strong></p>
<p>把View的点击事件，提成方法，这样在listener处只是一个方法调用者，一般的事件封装为：onXXXClick(View v)。</p>
<p><strong>4.3 设计一个BaseActivity类</strong></p>
<p>让所有的Activity都继承自BaseActivity类，这样，我们可以做很多有用的事情</p>
<ul>
<li>定义共通属性</li>
<li>显示共通对话框（Progress dialog)</li>
<li>取得top activity</li>
<li>可以手动管理启动的activity</li>
</ul>
<p><strong>4.4 设计Application类</strong></p>
<ul>
<li>存全局数据，比top activity, application context。</li>
</ul>
<p><strong>4.5 异常处理</strong></p>
<ul>
<li>报告功能是处理异常的精髓</li>
<li>在finally块中执行清理操作</li>
<li>不要用try-catch-finally来判断业务逻辑</li>
<li>考虑设计自定义的异常类</li>
</ul>
<p><strong>4.6 标注的使用</strong></p>
<ul>
<li>重写的方法一定要加@Override</li>
<li>不使用的方法，不要删除，可以标记为@Deprecated，这个做法在维护型的项目中特别有用。</li>
</ul>
<p><strong>4.7 注册与反注册</strong></p>
<ul>
<li>局部广播</li>
<li>各种listener</li>
<li>Service等</li>
</ul>
<p><strong>4.8 封装Bitmap操作</strong></p>
<p>我们应当把Bitmap操作封装起来，比如从文件加载，保存，网络下载，动态计算sample size等。有了封装后，我们可以对其集中优化。</p>
<p><strong>4.9 绘制处理</strong></p>
<p>一定要注意绘制方面的东西，不要在onDraw()/onTouchEvent()中创建新对象。</p>
</div></article></div><div class="block-sidebar column one-fourth"><div class="widget tags"></div><div class="widget archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">54</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">27</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">73</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">40</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">254</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">27</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">64</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">77</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">106</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">48</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">308</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">51</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">106</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">39</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">55</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">46</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">37</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">50</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">104</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">52</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">39</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">79</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">January 2012</a><span class="archive-list-count">1</span></li></ul></div><div class="widget text-content"><p>该博客使用基于 &nbsp;<a href="http://hexo.io">Hexo</a>&nbsp; 的 &nbsp;<a href="https://github.com/jysperm/hexo-theme-simpleblock">simpleblock</a>&nbsp; 主题。博客内容使用 &nbsp;<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn">CC BY-NC-SA 3.0</a>&nbsp; 授权发布。最后生成于 2018-02-03.</p></div></div></div></div></body></html>